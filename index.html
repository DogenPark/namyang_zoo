<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë‚¨ì–‘ì£¼ ë™ë¬¼ë³´ìœ¡ì›</title>

  <!-- favicon + logo -->
  <link rel="icon" href="images/logo.png" type="image/png" />
  <link rel="apple-touch-icon" href="images/logo.png" />

  <link rel="stylesheet" href="style.css" />

  <!-- âœ… index.htmlì—ì„œë§Œ ì¶”ê°€ ì˜¤ë²„ë¼ì´ë“œ (ëª¨ë°”ì¼ ì‚¬ì§„ 3ê°œì”© + ì•ˆì˜ë¦¼) -->
  <style>
    /* ì‚¬ì§„ EXIF ë°©í–¥(ì„¸ë¡œì‚¬ì§„ íšŒì „ ë¬¸ì œ ë°©ì§€) */
    img { image-orientation: from-image; }

    /* âœ… V-log ì‚¬ì§„: 3ê°œì”© ê·¸ë¦¬ë“œë¡œ ì­‰ */
    .photoGrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }

    /* ì¹´ë“œ(ig ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš©) */
    .photoGrid .ig{
      width:100%;
      border-radius: 18px;
      border: 1px solid rgba(20,20,30,.10);
      background: rgba(255,255,255,.70);
      overflow:hidden;
      box-shadow: var(--shadow2);
    }
    .photoGrid .ig__img{
      width:100%;
      border:0;
      padding:0;
      cursor:pointer;
      background: transparent;
    }

    /* âœ… í•µì‹¬: ì‚¬ì§„ ì•ˆì˜ë¦¬ê²Œ */
    .photoGrid .ig__img img{
      width:100%;
      height: 150px;          /* í•„ìš”í•˜ë©´ 140~190 ì¡°ì ˆ */
      object-fit: contain;    /* âœ… ì ˆëŒ€ ì•ˆ ì˜ë¦¼ */
      background: rgba(255,255,255,.70);
      display:block;
    }

    /* ëª¨ë°”ì¼(ì§„ì§œ í°)ì—ì„œëŠ” ì‚¬ì´ë“œë¥¼ ìœ„ë¡œ ì˜¬ë¦¬ê³  1ì»¬ëŸ¼ìœ¼ë¡œ */
    @media (max-width: 600px){
      .board{
        grid-template-columns: 1fr !important;
        gap: 12px;
      }
      .board__side{
        position: static !important;
        top:auto !important;
      }
      .photoGrid .ig__img img{
        height: 140px;
      }
    }

    /* ì§€ë„ ì—´ê¸° ë²„íŠ¼ */
    .mapFrame{ position: relative; }
    .mapOpen{
      position:absolute;
      right: 12px;
      bottom: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(20,20,30,.10);
      background: rgba(255,255,255,.78);
      box-shadow: var(--shadow2);
      font-weight: 700;
      text-decoration: none;
    }
  </style>
</head>

<body>
  <div id="top"></div>
  <a class="skip" href="#stories">ë³¸ë¬¸ ë°”ë¡œê°€ê¸°</a>

  <!-- Header -->
  <header class="topbar" id="home">
    <div class="wrap topbar__inner">
      <a class="brand" href="#home" aria-label="ë‚¨ì–‘ì£¼ ë™ë¬¼ë³´í˜¸ì†Œ í™ˆ">
        <img class="brand__logo" src="images/logo.png" alt="ë‚¨ì–‘ì£¼ ë™ë¬¼ë³´í˜¸ì†Œ ë¡œê³ " />
        <div class="brand__txt">
          <strong class="brand__name">ë‚¨ì–‘ì£¼ ë™ë¬¼ë³´ìœ¡ì›</strong>
          <span class="brand__sub">ì‘ì€ ìˆ¨ê²°ì„ ì§€í‚¤ëŠ” ê³µê°„</span>
        </div>
      </a>

      <nav class="nav">
        <a href="#stories">ë¸Œì´ë¡œê·¸</a>
        <a href="#cards">ë‚¨ì–‘ì£¼ ì²œì‚¬ë“¤</a>
        <a href="#contact">ë¬¸ì˜í•˜ê¸°</a>
        <a href="#map">ì˜¤ì‹œëŠ” ê¸¸</a>
      </nav>

      <button class="navBtn" id="navBtn" aria-label="ë©”ë‰´ ì—´ê¸°" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div class="mobileNav" id="mobileNav" aria-hidden="true">
      <a href="#stories">V-log</a>
      <a href="#cards">ë‚¨ì–‘ì£¼ ì²œì‚¬ë“¤</a>
      <a href="#contact">ë¬¸ì˜í•˜ê¸°</a>
      <a href="#map">ì˜¤ì‹œëŠ” ê¸¸</a>
    </div>
  </header>

  <!-- Hero Slider -->
  <section class="hero" aria-label="ëŒ€í‘œ ì´ë¯¸ì§€">
    <div class="hero__viewport">
      <div class="hero__track" id="heroTrack">
        <div class="hero__slide" style="--hero-bg:url('images/hero1.jpg')"><img src="images/hero1.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero2.jpg')"><img src="images/hero2.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero3.jpg')"><img src="images/hero3.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero4.jpg')"><img src="images/hero4.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero5.jpg')"><img src="images/hero5.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero6.jpg')"><img src="images/hero6.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero7.jpg')"><img src="images/hero7.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero8.jpg')"><img src="images/hero8.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero9.jpg')"><img src="images/hero9.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero10.jpg')"><img src="images/hero10.jpg" alt="..."></div>
        <div class="hero__slide" style="--hero-bg:url('images/hero11.jpg')"><img src="images/hero11.jpg" alt="..."></div>
      </div>

      <button class="hero__arrow hero__arrow--left" id="heroPrev" aria-label="ì´ì „ ì´ë¯¸ì§€">â€¹</button>
      <button class="hero__arrow hero__arrow--right" id="heroNext" aria-label="ë‹¤ìŒ ì´ë¯¸ì§€">â€º</button>
      <div class="hero__dots" id="heroDots" aria-label="ìŠ¬ë¼ì´ë“œ í‘œì‹œ"></div>
    </div>

    <div class="wrap hero__copy">
      <h1>ë‚¨ì–‘ì£¼ ë™ë¬¼ë³´ìœ¡ì›<br/>ì²œì‚¬ë“¤ì˜ ë³´ê¸ˆìë¦¬</h1>
      <p>í•œêµ­ ë°˜ë ¤ ë™ë¬¼ ê´€ë¦¬ì‚¬ í˜‘íšŒ ë™ë¬¼ë³´ìœ¡ì›</p>

      <div class="hero__chips" role="tablist" aria-label="ê²Œì‹œë¬¼ ë¶„ë¥˜">
        <button class="chip is-active" data-filter="all" role="tab" aria-selected="true">ì „ì²´</button>
        <button class="chip" data-filter="walk" role="tab" aria-selected="false">ì‚°ì±…ì´ì•¼ê¸°</button>
        <button class="chip" data-filter="daily" role="tab" aria-selected="false">ì¼ìƒì´ì•¼ê¸°</button>
      </div>
    </div>
  </section>

  <!-- Stories -->
  <main class="wrap" id="stories">
    <section class="section">
      <div class="section__head">
        <h2>V-log</h2>
        <p></p>
      </div>

      <div class="board">
        <aside class="board__side">
          <div class="panel">
            <div class="panel__title">íƒœê·¸ë¡œ ë³´ê¸°</div>
            <div class="tagCloud" id="tagCloud"></div>
            <div class="panel__hint"></div>
          </div>

          <!-- âœ… ì†Œê°œ íŒ¨ë„ ì‚­ì œë¨ -->
        </aside>

        <div class="board__main">
          <div class="rowHead">
            <h3>ì‚¬ì§„ ëª¨ì•„ë³´ê¸°</h3>
          </div>

          <!-- âœ… ì‚¬ì§„ 3ê°œì”© ê·¸ë¦¬ë“œ -->
          <div class="photoGrid" id="photoGrid" aria-label="ì‚¬ì§„ ê·¸ë¦¬ë“œ"></div>
        </div>
      </div>
    </section>

    <!-- Card Rotator -->
    <section class="section" id="cards">
      <div class="section__head">
        <h2>ë‚¨ì–‘ì£¼ ì²œì‚¬ë“¤</h2>
        <p>ì‘ì€ë™ë¬¼ë“¤ì˜ ê°„ë‹¨í•œ ì¼ìƒì´ì•¼ê¸°</p>
      </div>

      <div class="rotator">
        <div class="rotator__stage" id="rotatorStage" aria-label="ì¹´ë“œ ë¡œí…Œì´í„°"></div>
        <button class="rotArrow rotArrow--left" id="rotPrev" aria-label="ì´ì „ ì¹´ë“œ">â€¹</button>
        <button class="rotArrow rotArrow--right" id="rotNext" aria-label="ë‹¤ìŒ ì¹´ë“œ">â€º</button>
        <div class="rotator__hint">ì‚¬ì§„ì„ ëˆ„ë¥´ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆì–´ìš”</div>
      </div>
    </section>

    <!-- Contact -->
    <section class="section" id="contact">
      <div class="section__head">
        <h2>ë¬¸ì˜í•˜ê¸°</h2>
        <p>ì „í™” / ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ… / ì¸ìŠ¤íƒ€ê·¸ë¨ë¬¸ì˜</p>
      </div>

      <div class="contactGrid">
        <a class="contactCard" href="tel:010-3988-8337" aria-label="ì „í™” ê±¸ê¸°">
          <div class="contactCard__icon">â˜</div>
          <div class="contactCard__txt">
            <strong>ì „í™”</strong>
            <span class="muted">010-3988-8337</span>
          </div>
          <span class="contactCard__go">ë°”ë¡œê°€ê¸° â†’</span>
        </a>

        <a class="contactCard" href="https://open.kakao.com/o/soxdPfIh?utm_source=ig&utm_medium=social&utm_content=link_in_bio&fbclid=PAb21jcAP-bShleHRuA2FlbQIxMQBzcnRjBmFwcF9pZA81NjcwNjczNDMzNTI0MjcAAadaddT434c8JNuzH4sdL38HF_jwCwEODj_RY6QIYBl0MPw_MMKB2DXNylEymw_aem_Roe6QMx29OIKeBQsFIlipw"
           target="_blank" rel="noopener" aria-label="ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ… ì—´ê¸°">
          <div class="contactCard__icon">ğŸ’¬</div>
          <div class="contactCard__txt">
            <strong>ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…</strong>
            <span class="muted">êµ¬ì¡° â€¢ íƒì • â€¢ ì…ì–‘ â€¢ íŒŒì–‘ â€¢ í˜¸í…”ë§</span>
          </div>
          <span class="contactCard__go">ë°”ë¡œê°€ê¸° â†’</span>
        </a>

        <a class="contactCard" href="https://www.instagram.com/namyang_zoo/" target="_blank" rel="noopener" aria-label="ì¸ìŠ¤íƒ€ê·¸ë¨ ì—´ê¸°">
          <div class="contactCard__icon">ğŸ“·</div>
          <div class="contactCard__txt">
            <strong>ì¸ìŠ¤íƒ€ê·¸ë¨</strong>
            <span class="muted">@namyang_zoo</span>
          </div>
          <span class="contactCard__go">ë°”ë¡œê°€ê¸° â†’</span>
        </a>
      </div>
    </section>

    <!-- Map -->
    <section class="section" id="map">
      <div class="section__head">
        <h2>ì˜¤ì‹œëŠ” ê¸¸</h2>
        <p>ì˜¤ì‹œê¸° ì „ì— ë¬¸ì˜ì—°ë½ ë¶€íƒë“œë ¤ìš”.</p>
      </div>

      <div class="mapCard">
        <div class="mapCard__meta">
          <strong>ë‚¨ì–‘ì£¼ ë™ë¬¼ë³´ìœ¡ì›</strong>
          <span class="muted">ì§„ê±´ì ì§„ê±´ì˜¤ë‚¨ë¡œ 105ë²ˆê¸¸ 16 202í˜¸</span>
        </div>

        <div class="mapFrame" aria-label="ì§€ë„">
          <!-- âœ… ëª¨ë°”ì¼ì—ì„œ í•­ìƒ ëœ¨ëŠ” Google Maps embed -->
          <iframe
            title="ë‚¨ì–‘ì£¼ ë™ë¬¼ë³´ìœ¡ì› ì§€ë„"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps?q=%EA%B2%BD%EA%B8%B0%EB%8F%84%20%EB%82%A8%EC%96%91%EC%A3%BC%EC%8B%9C%20%EC%A7%84%EA%B1%B4%EC%9D%8D%20%EC%A7%84%EA%B1%B4%EC%98%A4%EB%82%A8%EB%A1%9C%20105%EB%B2%88%EA%B8%B8%2016%20202%ED%98%B8&output=embed">
          </iframe>

          <!-- âœ… ë„¤ì´ë²„ì§€ë„ëŠ” iframeì´ ë§‰í˜€ì„œ ë²„íŠ¼ìœ¼ë¡œ ì—´ê¸° -->
          <a class="mapOpen"
             href="https://map.naver.com/p/search/%EC%A7%84%EA%B1%B4%EC%98%A4%EB%82%A8%EB%A1%9C%20105%EB%B2%88%EA%B8%B8%2016%20202%ED%98%B8"
             target="_blank" rel="noopener">
            ë„¤ì´ë²„ì§€ë„ì—ì„œ ì—´ê¸° â†’
          </a>
        </div>

        <div class="mapCard__foot">
          <span class="muted">ì§„ê±´ì ì§„ê±´ì˜¤ë‚¨ë¡œ 105ë²ˆê¸¸ 16 202í˜¸, Namyangju</span>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="wrap footer__inner">
      <div class="footer__brand">
        <img src="images/logo.png" alt="" />
        <div>
          <strong>ë‚¨ì–‘ì£¼ ë™ë¬¼ë³´ìœ¡ì›</strong>
          <p class="muted">Â© <span id="year"></span> namyang_zoo</p>
        </div>
      </div>

      <div class="footer__links">
        <a href="#top">ìœ„ë¡œ</a>
        <a href="#contact">ë¬¸ì˜</a>
      </div>
    </div>
  </footer>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true" role="dialog" aria-label="ì´ë¯¸ì§€ í¬ê²Œë³´ê¸°">
    <div class="modal__backdrop" data-close="1"></div>
    <div class="modal__panel" role="document">
      <button class="modal__close" id="modalClose" aria-label="ë‹«ê¸°">Ã—</button>
      <img class="modal__img" id="modalImg" alt="í™•ëŒ€ ì´ë¯¸ì§€" />
      <div class="modal__cap" id="modalCap"></div>
    </div>
  </div>

  <script>
  // ===== DATA =====
  const POSTS = [
    { id:"b1",  img:"images/blog1.jpg",  cat:"daily", title:"í¬ê·¼í•œ ë‚®ì ",          tags:["#ì¼ìƒ","#í¬ê·¼","#ë§í‹°ì¦ˆ"] },
    { id:"b2",  img:"images/blog2.jpg",  cat:"daily", title:"ì˜¤ëŠ˜ì˜ íœ´ì‹",          tags:["#ì¼ìƒ","#íœ´ì‹"] },
    { id:"b3",  img:"images/blog3.jpg",  cat:"daily", title:"ìƒˆ ì˜· ì…ì—ˆì–´ìš”",       tags:["#ì¼ìƒ","#ì˜·","#ê°•ì•„ì§€"] },
    { id:"b4",  img:"images/blog4.jpg",  cat:"daily", title:"ë°”ë‹¥ì´ ìµœê³ ",          tags:["#ì¼ìƒ","#í‘¸ë“¤"] },
    { id:"b5",  img:"images/blog5.jpg",  cat:"daily", title:"í–„ìŠ¤í„° ê·¼í™©",          tags:["#ì¼ìƒ","#í–„ìŠ¤í„°"] },
    { id:"b6",  img:"images/blog6.jpg",  cat:"daily", title:"ì¡¸ë¦° ì˜¤í›„",            tags:["#ì¼ìƒ","#í‘¸ë“¤"] },
    { id:"b7",  img:"images/blog7.jpg",  cat:"daily", title:"ì•ˆë…•! ë°˜ê°€ì›Œìš”",       tags:["#ì¼ìƒ","#ë§í‹°ì¦ˆ"] },
    { id:"b8",  img:"images/blog8.jpg",  cat:"daily", title:"ê°™ì´ ìˆìœ¼ë©´ ë” ì¢‹ì•„",  tags:["#ì¼ìƒ","#ì¹œêµ¬","#í‘¸ë“¤"] },
    { id:"b9",  img:"images/blog9.png",  cat:"daily", title:"ì˜¤ëŠ˜ì€ ê·€ì—¬ì›€ ì¥ì°©",   tags:["#ì¼ìƒ","#ì½”ë””"] },
    { id:"b10", img:"images/blog10.jpg", cat:"walk",  title:"ì‚°ì±… ì¶œë°œ!",           tags:["#ì‚°ì±…","#ë°”ëŒ","#ìƒ¤í˜ì´"] },
    { id:"b11", img:"images/blog11.jpg", cat:"walk",  title:"í–‡ì‚´ ì¢‹ì€ ë‚ ",         tags:["#ì‚°ì±…","#í–‡ì‚´"] },
    { id:"b12", img:"images/blog12.jpg", cat:"walk",  title:"ì‚°ì±…ê¸¸ì—ì„œ ì°°ì¹µ",       tags:["#ì‚°ì±…","#ê°•ì•„ì§€"] },
  ];

  const ROTATOR_CARDS = Array.from({length:16}, (_,i) => ({
    id: "c"+(i+1),
    img: "images/card"+(i+1)+".jpg",
    title: "ì˜¤ëŠ˜ì˜ ì¹´ë“œ #"+(i+1),
  }));

  // ===== Helpers =====
  const $ = (s, el=document) => el.querySelector(s);
  const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));

  // ===== Mobile nav =====
  const navBtn = $("#navBtn");
  const mobileNav = $("#mobileNav");
  navBtn.addEventListener("click", () => {
    const open = navBtn.getAttribute("aria-expanded") === "true";
    navBtn.setAttribute("aria-expanded", String(!open));
    mobileNav.classList.toggle("is-open", !open);
    mobileNav.setAttribute("aria-hidden", String(open));
  });
  $$("#mobileNav a").forEach(a => a.addEventListener("click", () => {
    navBtn.setAttribute("aria-expanded","false");
    mobileNav.classList.remove("is-open");
    mobileNav.setAttribute("aria-hidden","true");
  }));

  // ===== Hero slider =====
  const heroTrack = $("#heroTrack");
  const heroSlides = $$(".hero__slide", heroTrack);
  const heroDots = $("#heroDots");
  let heroIdx = 0;
  let heroTimer = null;

  function renderHeroDots(){
    heroDots.innerHTML = heroSlides.map((_,i)=>(
      '<button class="dot '+(i===heroIdx?'is-on':'')+'" aria-label="ìŠ¬ë¼ì´ë“œ '+(i+1)+'" data-i="'+i+'"></button>'
    )).join("");
    $$(".dot", heroDots).forEach(btn => btn.addEventListener("click", () => {
      goHero(+btn.dataset.i);
      restartHero();
    }));
  }
  function goHero(i){
    heroIdx = (i + heroSlides.length) % heroSlides.length;
    heroTrack.style.transform = `translateX(${-heroIdx*100}%)`;
    renderHeroDots();
  }
  function restartHero(){
    clearInterval(heroTimer);
    heroTimer = setInterval(() => goHero(heroIdx+1), 3000);
  }
  $("#heroPrev").addEventListener("click", () => { goHero(heroIdx-1); restartHero(); });
  $("#heroNext").addEventListener("click", () => { goHero(heroIdx+1); restartHero(); });

  // swipe
  (function(){
    let startX=0, dx=0, touching=false;
    const vp = heroTrack.parentElement;
    vp.addEventListener("touchstart",(e)=>{ touching=true; startX=e.touches[0].clientX; dx=0; },{passive:true});
    vp.addEventListener("touchmove",(e)=>{ if(!touching) return; dx=e.touches[0].clientX-startX; },{passive:true});
    vp.addEventListener("touchend",()=>{
      if(!touching) return;
      touching=false;
      if(Math.abs(dx) > 40){
        goHero(heroIdx + (dx<0 ? 1 : -1));
        restartHero();
      }
    });
  })();

  renderHeroDots();
  goHero(0);
  restartHero();

  // ===== Posts rendering (photo grid) =====
  const photoGrid = $("#photoGrid");
  const tagCloud = $("#tagCloud");

  function gridCard(post){
    const badge = post.cat === "walk" ? "ì‚°ì±…ì´ì•¼ê¸°" : "ì¼ìƒì´ì•¼ê¸°";
    return `
      <article class="ig" data-id="${post.id}" data-cat="${post.cat}" data-tags="${post.tags.join(" ")}">
        <button class="ig__img" data-open="${post.img}" data-cap="${badge} Â· ${post.title}">
          <img src="${post.img}" alt="${post.title}">
        </button>
        <div class="ig__body">
          <div class="ig__meta">
            <span class="badge ${post.cat==="walk"?"is-walk":"is-daily"}">${badge}</span>
            <span class="muted dotSep">Â·</span>
            <span class="muted">${post.title}</span>
          </div>
          <div class="ig__tags">${post.tags.map(t => `<span class="tag">${t}</span>`).join("")}</div>
        </div>
      </article>
    `;
  }

  function renderPosts(){
    photoGrid.innerHTML = POSTS.map(p => gridCard(p)).join("");

    // Tags
    const allTags = new Map();
    POSTS.forEach(p => p.tags.forEach(t => allTags.set(t, (allTags.get(t)||0)+1)));
    tagCloud.innerHTML = ['#ì „ì²´', ...Array.from(allTags.keys())].map(t => {
      const isAll = t === '#ì „ì²´';
      const count = isAll ? POSTS.length : allTags.get(t);
      return `<button class="tagChip ${isAll?'is-on':''}" data-tag="${t}">${t}<span class="cnt">${count}</span></button>`;
    }).join("");

    // bind modal open
    $$("[data-open]").forEach(btn => {
      btn.addEventListener("click", () => openModal(btn.dataset.open, btn.dataset.cap));
    });

    // tag click
    $$(".tagChip").forEach(btn => {
      btn.addEventListener("click", () => {
        $$(".tagChip").forEach(b => b.classList.toggle("is-on", b===btn));
        const tag = btn.dataset.tag;
        applyFilters(currentCat, tag === "#ì „ì²´" ? null : tag);
      });
    });
  }

  // ===== Filters =====
  let currentCat = "all";
  let currentTag = null;

  function applyFilters(cat, tag){
    currentCat = cat;
    currentTag = tag;

    // update chips
    $$(".chip").forEach(c => {
      const on = c.dataset.filter === cat;
      c.classList.toggle("is-active", on);
      c.setAttribute("aria-selected", String(on));
    });

    function match(el){
      const okCat = (cat==="all") || (el.dataset.cat === cat);
      const okTag = (!tag) || (el.dataset.tags || "").includes(tag);
      return okCat && okTag;
    }

    [...photoGrid.children].forEach(el => {
      el.classList.toggle("is-hidden", !match(el));
    });
  }

  $$(".chip").forEach(btn => btn.addEventListener("click", () => {
    applyFilters(btn.dataset.filter, currentTag);
  }));

  renderPosts();
  applyFilters("all", null);

  // ===== Modal =====
  const modal = $("#modal");
  const modalImg = $("#modalImg");
  const modalCap = $("#modalCap");
  const modalClose = $("#modalClose");

  function openModal(src, cap){
    modalImg.src = src;
    modalCap.textContent = cap || "";
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden","false");
    document.body.classList.add("noScroll");
  }
  function closeModal(){
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden","true");
    document.body.classList.remove("noScroll");
  }
  modalClose.addEventListener("click", closeModal);
  modal.addEventListener("click", (e) => {
    if(e.target && e.target.dataset && e.target.dataset.close) closeModal();
  });
  window.addEventListener("keydown", (e) => {
    if(e.key === "Escape" && modal.classList.contains("is-open")) closeModal();
  });

  // ===== 3D Card Rotator =====
  const stage = document.querySelector("#rotatorStage");
  let rotIdx = 0;
  let rotTimer = null;

  function renderRotator(){
    stage.innerHTML = `<div class="rotStack" id="rotStack"></div>`;
    const stack = document.querySelector("#rotStack");

    stack.innerHTML = ROTATOR_CARDS.map((c,i) => `
      <button class="rotCard is-hide" data-i="${i}" data-open="${c.img}" data-cap="${c.title}">
        <img src="${c.img}" alt="${c.title}">
      </button>
    `).join("");

    stack.querySelectorAll(".rotCard").forEach(btn => {
      btn.addEventListener("click", () => openModal(btn.dataset.open, btn.dataset.cap));
    });

    updateRotator();
  }

  function updateRotator(){
    const cards = Array.from(document.querySelectorAll(".rotCard"));
    const n = cards.length;
    if(n === 0) return;

    const left = (rotIdx - 1 + n) % n;
    const right = (rotIdx + 1) % n;

    cards.forEach((el, i) => {
      el.classList.remove("is-left","is-right","is-center","is-hide");
      if(i === rotIdx) el.classList.add("is-center");
      else if(i === left) el.classList.add("is-left");
      else if(i === right) el.classList.add("is-right");
      else el.classList.add("is-hide");
    });
  }

  function rotGo(nextIdx){
    const n = ROTATOR_CARDS.length;
    rotIdx = (nextIdx + n) % n;
    updateRotator();
  }

  function rotRestart(){
    clearInterval(rotTimer);
    rotTimer = setInterval(() => rotGo(rotIdx + 1), 3000);
  }

  document.querySelector("#rotPrev").addEventListener("click", () => { rotGo(rotIdx - 1); rotRestart(); });
  document.querySelector("#rotNext").addEventListener("click", () => { rotGo(rotIdx + 1); rotRestart(); });

  // swipe
  (function(){
    let startX=0, dx=0, touching=false;
    const box = stage.parentElement;

    box.addEventListener("touchstart",(e)=>{ touching=true; startX=e.touches[0].clientX; dx=0; },{passive:true});
    box.addEventListener("touchmove",(e)=>{ if(!touching) return; dx=e.touches[0].clientX-startX; },{passive:true});
    box.addEventListener("touchend",()=>{
      if(!touching) return;
      touching=false;
      if(Math.abs(dx) > 35){
        rotGo(rotIdx + (dx<0 ? 1 : -1));
        rotRestart();
      }
    });
  })();

  renderRotator();
  rotRestart();

  // footer year
  $("#year").textContent = new Date().getFullYear();
  </script>
</body>
</html>